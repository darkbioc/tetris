<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Board.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;Tetris&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">default</a> &gt; <span class="el_source">Board.java</span></div><h1>Board.java</h1><pre class="source lang-java linenums">
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.*;

/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
/**
 *
 * @author victor
 */
public class Board extends JPanel implements ActionListener {
<span class="fc" id="L21">    class MyKeyAdapter extends KeyAdapter </span>
    {
        @Override
        public void keyPressed(KeyEvent e) 
        {
<span class="pc bpc" id="L26" title="3 of 6 branches missed.">        switch (e.getKeyCode()) {</span>
        case KeyEvent.VK_LEFT:
<span class="pc bpc" id="L28" title="1 of 2 branches missed.">            if(canMove(currentShape,currentRow,currentCol-1))</span>
<span class="fc" id="L29">                currentCol--;</span>
            break;
        case KeyEvent.VK_RIGHT:
<span class="nc bnc" id="L32" title="All 2 branches missed.">            if(canMove(currentShape,currentRow,currentCol+1))</span>
<span class="nc" id="L33">                currentCol++;</span>
            break;
        case KeyEvent.VK_UP:
<span class="fc" id="L36">            Shape rotShape = currentShape.rotateRight();</span>
<span class="pc bpc" id="L37" title="1 of 2 branches missed.">            if(currentCol==0)</span>
            {
<span class="nc bnc" id="L39" title="All 2 branches missed.">                if(canMove(currentShape, currentRow, currentCol+1))</span>
                {
<span class="nc bnc" id="L41" title="All 4 branches missed.">                    if(currentShape.getYMin()==-2 &amp;&amp; canMove(currentShape, currentRow, currentCol+2))</span>
                    {
<span class="nc bnc" id="L43" title="All 2 branches missed.">                        if(!hitWithMatrix(rotShape, currentRow, currentCol+2))</span>
                                {
<span class="nc" id="L45">                                    currentCol+=2;</span>
<span class="nc" id="L46">                                    currentShape=rotShape;</span>
                                }
                    }
<span class="nc bnc" id="L49" title="All 2 branches missed.">                    else if(currentShape.getYMax()==2)</span>
                    {
<span class="nc bnc" id="L51" title="All 2 branches missed.">                        if(canMove(rotShape, currentRow, currentCol+1))</span>
                        {
<span class="nc" id="L53">                            currentCol++;</span>
<span class="nc" id="L54">                            currentShape=rotShape;</span>
                        }
                    }
<span class="nc bnc" id="L57" title="All 2 branches missed.">                    else if (currentShape.getYMin()!=-2 )</span>
                    {
<span class="nc" id="L59">                        currentCol++;</span>
<span class="nc" id="L60">                        currentShape=rotShape;</span>
                    }
                    
                }
            }
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">            else if(currentCol==9)</span>
            {
<span class="nc bnc" id="L67" title="All 2 branches missed.">                if(canMove(currentShape, currentRow, currentCol-1))</span>
                {
<span class="nc bnc" id="L69" title="All 4 branches missed.">                    if(currentShape.getYMax()==2 &amp;&amp; canMove(currentShape, currentRow, currentCol-2))</span>
                    {
<span class="nc bnc" id="L71" title="All 2 branches missed.">                        if(!hitWithMatrix(rotShape, currentRow, currentCol-2))</span>
                        {
<span class="nc" id="L73">                            currentCol-=2;</span>
<span class="nc" id="L74">                            currentShape=rotShape;</span>
                        }                      
                    }
<span class="nc bnc" id="L77" title="All 2 branches missed.">                    else if(currentShape.getYMin()==-2)</span>
                    {
<span class="nc bnc" id="L79" title="All 2 branches missed.">                        if(canMove(rotShape, currentRow, currentCol-1))</span>
                        {
<span class="nc" id="L81">                            currentCol--;</span>
<span class="nc" id="L82">                            currentShape=rotShape;</span>
                        }
                    }
<span class="nc bnc" id="L85" title="All 2 branches missed.">                    else if(currentShape.getYMax()!=2)</span>
                    {
<span class="nc" id="L87">                        currentCol--;</span>
<span class="nc" id="L88">                        currentShape=rotShape;</span>
                    }
                }
            }
<span class="pc bpc" id="L92" title="3 of 4 branches missed.">            else if(currentCol==8 &amp;&amp; currentShape.getYMax()==2)</span>
            {
<span class="nc bnc" id="L94" title="All 2 branches missed.">                if(!hitWithMatrix(rotShape, currentRow, currentCol-1))</span>
                {
<span class="nc" id="L96">                    currentCol--;</span>
<span class="nc" id="L97">                    currentShape=rotShape;</span>
                }
            }
<span class="pc bpc" id="L100" title="3 of 4 branches missed.">            else if(currentCol==2 &amp;&amp; currentShape.getYMin()==-2)</span>
            {
<span class="nc bnc" id="L102" title="All 2 branches missed.">                if(!hitWithMatrix(rotShape, currentRow, currentCol+1))</span>
                {
<span class="nc" id="L104">                    currentCol++;</span>
<span class="nc" id="L105">                    currentShape=rotShape;</span>
                }
            }
<span class="pc bpc" id="L108" title="1 of 2 branches missed.">            else if(!hitWithMatrix(rotShape, currentRow, currentCol))</span>
            {
<span class="fc" id="L110">                currentShape=rotShape;</span>
            }
            
            /*if(canMove(rotShape,currentRow, currentCol))
            {
                currentShape=rotShape;
            }*/
        break;
        case KeyEvent.VK_DOWN:
<span class="nc bnc" id="L119" title="All 2 branches missed.">            if(canMove(currentShape,currentRow+1, currentCol))</span>
<span class="nc" id="L120">                currentRow++;</span>
        break;
        case KeyEvent.VK_P:
<span class="nc bnc" id="L123" title="All 2 branches missed.">            if(!timer.isRunning())</span>
            {
<span class="nc" id="L125">                scoreBoard.resume();;</span>
<span class="nc" id="L126">                timer.start();</span>
            }
            else
            {
<span class="nc" id="L130">                timer.stop();</span>
<span class="nc" id="L131">                scoreBoard.pause();</span>
            }
<span class="nc" id="L133">        break;</span>
        default:
        break;
        }
<span class="fc" id="L137">        repaint();</span>
<span class="fc" id="L138">        }</span>
    }
    public ScoreBoard scoreBoard;
    
    public static final int NUM_ROWS = 22;
    public static final int NUM_COLS = 10;

    private Tetrominoes[][] matrix;
    private int deltaTime;

    private Shape currentShape;

    private int currentRow;
    private int currentCol;

    private Timer timer;
    
<span class="fc" id="L155">    private boolean paused=false;</span>
    MyKeyAdapter keyAdepter;
    
    public static final int INIT_ROW = -1;

    public Board() {
<span class="fc" id="L161">        super();</span>
<span class="fc" id="L162">        matrix = new Tetrominoes[NUM_ROWS][NUM_COLS];</span>
<span class="fc" id="L163">        initValues();</span>
<span class="fc" id="L164">        timer = new Timer(deltaTime, this);</span>
<span class="fc" id="L165">        keyAdepter= new MyKeyAdapter();</span>
        
<span class="fc" id="L167">    }</span>

    public void initValues() {
<span class="fc" id="L170">        setFocusable(true);</span>
<span class="fc" id="L171">        cleanBoard();</span>
<span class="fc" id="L172">        deltaTime = 500;</span>
<span class="fc" id="L173">        currentShape = null;</span>
<span class="fc" id="L174">        currentRow = INIT_ROW;</span>
<span class="fc" id="L175">        currentCol = NUM_COLS / 2;</span>
<span class="fc" id="L176">    }</span>

    public void initGame() {
<span class="fc" id="L179">        removeKeyListener(keyAdepter);</span>
<span class="fc" id="L180">        initValues();</span>
<span class="fc" id="L181">        currentShape = new Shape();</span>
<span class="fc" id="L182">        timer.start();</span>
<span class="fc" id="L183">        addKeyListener(keyAdepter);</span>
        
<span class="fc" id="L185">    }</span>
    
    public void setScoreBoard(ScoreBoard scoreboard)
    {
<span class="fc" id="L189">        this.scoreBoard=scoreboard;</span>
<span class="fc" id="L190">    }</span>

    public void cleanBoard() {
<span class="fc bfc" id="L193" title="All 2 branches covered.">        for (int row = 0; row &lt; NUM_ROWS; row++) {</span>
<span class="fc bfc" id="L194" title="All 2 branches covered.">            for (int col = 0; col &lt; NUM_COLS; col++) {</span>
<span class="fc" id="L195">                matrix[row][col] = Tetrominoes.NoShape;</span>
            }
        }
<span class="fc" id="L198">    }</span>

    // Game Main Loop
    @Override
    public void actionPerformed(ActionEvent ae) 
    {
<span class="pc bpc" id="L204" title="1 of 2 branches missed.">        if(canMove(currentShape,currentRow+1, currentCol))</span>
        {
<span class="fc" id="L206">            currentRow++;</span>
<span class="fc" id="L207">            repaint();</span>
        }
        else
        {
<span class="nc" id="L211">            moveCurrentShapeToMatrix();</span>
<span class="nc" id="L212">            checkRows();</span>
<span class="nc" id="L213">            currentShape = new Shape();</span>
<span class="nc" id="L214">            currentRow = INIT_ROW;</span>
<span class="nc" id="L215">            currentCol = NUM_COLS/2;</span>
        }
<span class="fc" id="L217">    }</span>
    private void moveCurrentShapeToMatrix()
    {
<span class="nc" id="L220">        int[][] squaresArray = currentShape.getCoordinates();</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">        for(int point = 0; point&lt;=3; point++)</span>
        {
<span class="nc" id="L223">            matrix[currentRow+squaresArray[point][1]][currentCol+squaresArray[point][0]]=currentShape.getShape();</span>
        }
<span class="nc" id="L225">    }</span>

    @Override
    protected void paintComponent(Graphics g) {
<span class="fc" id="L229">        super.paintComponent(g);</span>
<span class="fc" id="L230">        drawBoard(g);</span>
<span class="fc bfc" id="L231" title="All 2 branches covered.">        if (currentShape!=null)</span>
<span class="fc" id="L232">        drawCurrentShape(g);</span>
<span class="fc" id="L233">    }</span>
    public void drawBoard(Graphics g)
    {
<span class="fc bfc" id="L236" title="All 2 branches covered.">        for (int row = 0; row &lt; NUM_ROWS; row++) </span>
        {
<span class="fc bfc" id="L238" title="All 2 branches covered.">            for (int col = 0; col &lt; NUM_COLS; col++) </span>
            {
<span class="fc" id="L240">                drawSquare(g, row, col, matrix[row][col]);</span>
            }
        }
<span class="fc" id="L243">    }</span>
    private void drawSquare(Graphics g, int row, int col, Tetrominoes shape) {
<span class="fc" id="L245">        Color colors[] = {new Color(0, 0, 0),</span>
            new Color(204, 102, 102),
            new Color(102, 204, 102), new Color(102, 102, 204),
            new Color(204, 204, 102), new Color(204, 102, 204),
            new Color(102, 204, 204), new Color(218, 170, 0)
        };
<span class="fc" id="L251">        int x = col * squareWidth();</span>
<span class="fc" id="L252">        int y = row * squareHeight();</span>
<span class="fc" id="L253">        Color color = colors[shape.ordinal()];</span>
<span class="fc" id="L254">        g.setColor(color);</span>
<span class="fc" id="L255">        g.fillRect(x + 1, y + 1, squareWidth() - 2,</span>
<span class="fc" id="L256">                squareHeight() - 2);</span>
<span class="fc" id="L257">        g.setColor(color.brighter());</span>
<span class="fc" id="L258">        g.drawLine(x, y + squareHeight() - 1, x, y);</span>
<span class="fc" id="L259">        g.drawLine(x, y, x + squareWidth() - 1, y);</span>
<span class="fc" id="L260">        g.setColor(color.darker());</span>
<span class="fc" id="L261">        g.drawLine(x + 1, y + squareHeight() - 1,</span>
<span class="fc" id="L262">                x + squareWidth() - 1, y + squareHeight() - 1);</span>
<span class="fc" id="L263">        g.drawLine(x + squareWidth() - 1,</span>
<span class="fc" id="L264">                y + squareHeight() - 1,</span>
<span class="fc" id="L265">                x + squareWidth() - 1, y + 1);</span>
<span class="fc" id="L266">    }</span>
    
    private int squareWidth() {
<span class="fc" id="L269">        return getWidth() / NUM_COLS;</span>
    }
    
    private int squareHeight() {
<span class="fc" id="L273">        return getHeight() / NUM_ROWS;</span>
    }
    private void drawCurrentShape(Graphics g) 
    {
<span class="fc" id="L277">    int[][] squaresArray = currentShape.getCoordinates();</span>
<span class="fc bfc" id="L278" title="All 2 branches covered.">    for(int point = 0; point&lt;=3; point++)</span>
        {
<span class="fc" id="L280">        drawSquare(g, currentRow + squaresArray[point][1], currentCol + squaresArray[point][0], currentShape.getShape());</span>
        }
<span class="fc" id="L282">    }</span>
    
    private boolean canMove(Shape shape, int newRow, int newCol)
    {
<span class="pc bpc" id="L286" title="4 of 8 branches missed.">        if(newCol + shape.getXMin()&lt;0 || (newCol+shape.getXMax()&gt;= NUM_COLS || newRow + shape.getYMax()&gt;=NUM_ROWS || hitWithMatrix(shape,newRow, newCol)))</span>
        {
<span class="nc" id="L288">            return false;</span>
        }
<span class="fc" id="L290">        return true;</span>
    }
    private boolean hitWithMatrix(Shape shape, int row, int col)
    {
<span class="fc" id="L294">        int[][] squaresArray = shape.getCoordinates();</span>
<span class="fc bfc" id="L295" title="All 2 branches covered.">        for(int point = 0; point&lt;=3; point++)</span>
        {
<span class="fc" id="L297">            int mRow = row+squaresArray[point][1];</span>
<span class="fc" id="L298">            int mCol = col+squaresArray[point][0];</span>
<span class="fc bfc" id="L299" title="All 2 branches covered.">            if(mRow &gt;= 0)</span>
            {
<span class="pc bpc" id="L301" title="1 of 2 branches missed.">                if(matrix[mRow][mCol] != Tetrominoes.NoShape)</span>
                {
<span class="nc" id="L303">                    return true;</span>
                }
            }
        }
<span class="fc" id="L307">        return false;</span>
    }
    public void checkRows()
    {
<span class="nc bnc" id="L311" title="All 2 branches missed.">        for (int i = 0; i &lt; NUM_ROWS; i++) </span>
        {
<span class="nc" id="L313">            int  counter=0;</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">            for (int j = 0; j &lt; NUM_COLS; j++) </span>
            {
<span class="nc bnc" id="L316" title="All 2 branches missed.">                if(matrix[i][j]!=Tetrominoes.NoShape)</span>
                {
<span class="nc" id="L318">                    counter++;</span>
                }
<span class="nc bnc" id="L320" title="All 2 branches missed.">                if(counter==10)</span>
                {
<span class="nc" id="L322">                    scoreBoard.increment(100);</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">                    for (int k = i; k &gt; 0; k--) </span>
                    {
<span class="nc bnc" id="L325" title="All 2 branches missed.">                        for (int l = 0; l &lt; NUM_COLS; l++) </span>
                        {
<span class="nc" id="L327">                            matrix[k][l]=matrix[k-1][l];</span>
                        }
                    }
<span class="nc bnc" id="L330" title="All 2 branches missed.">                    for (int k = 0; k &lt; NUM_COLS; k++) </span>
                    {
<span class="nc" id="L332">                        matrix[0][k]=Tetrominoes.NoShape;</span>
                    }
                }
            }
        }
<span class="nc" id="L337">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>